jQuery.fn.stalker=function(){var $win,$doc,$stalker,$transitionElems,offsetY,placeholder,lastScrollPosY,stalkerHeight,isInitialized,selector;function isSupported(){if(jQuery.browser.msie&&jQuery.browser.version<7||(!jQuery.os.mac&&jQuery.browser.mozilla&&getBrowserVersionAsInt()<191)){return false}return true}function getBrowserVersionAsInt(){return parseInt(jQuery.browser.version.replace(/\.*/g,"").substring(0,3),10)}function getInactiveProperties(){if(jQuery.os.windows||jQuery.os.linux){return{position:"absolute",top:offsetY}}else{return{position:"fixed",top:offsetY-$win.scrollTop()}}}function needToApplyFlickerFix(){var browserVersion=jQuery.browser.version.replace(/\.*/g,"").substring(0,3);return jQuery.browser.mozilla&&browserVersion<192}function initialize(){$stalker=jQuery(selector),offsetY=$stalker.offset().top,$transitionElems=$stalker.prevAll(":visible");function setStalkerHeight(){$stalker.css("overflow","hidden");stalkerHeight=$stalker.height();$stalker.css("overflow","")}function createPlaceholder(){placeholder=jQuery("<div />").addClass("stalker-placeholder").css({visibility:"hidden",height:stalkerHeight}).insertBefore($stalker)}function setPlaceholderHeight(){if(!$stalker.hasClass("detached")){placeholder.height($stalker.height())}else{placeholder.height($stalker.removeClass("detached").height());$stalker.addClass("detached")}}setStalkerHeight();createPlaceholder();setPlaceholderHeight();$stalker.css(getInactiveProperties());$stalker.bind("stalkerHeightUpdated",setPlaceholderHeight);$stalker.bind("positionChanged",setStalkerPosition);if(needToApplyFlickerFix()){$stalker.addClass("fix-ff35-flicker")}isInitialized=true}function offsetPageScrolling(){function setScrollPostion(scrollTarget){var docHeight=jQuery.getDocHeight(),scrollPos;if(scrollTarget>=0&&scrollTarget<=docHeight){scrollPos=scrollTarget}else{if(scrollTarget>=$win.scrollTop()){scrollPos=docHeight}else{if(scrollTarget<0){scrollPos=0}}}$win.scrollTop(scrollPos)}function pageUp(){if(!isInitialized){initialize()}var scrollTarget=jQuery(window).scrollTop()-jQuery(window).height();setScrollPostion(scrollTarget+stalkerHeight)}function pageDown(){if(!isInitialized){initialize()}var scrollTarget=jQuery(window).scrollTop()+jQuery(window).height();setScrollPostion(scrollTarget-stalkerHeight)}jQuery(function(){$doc.bind("keydown keypress keyup",{combi:"pagedown",disableInInput:true},function(e){if(!jQuery.browser.mozilla&&e.type==="keydown"){pageDown()}else{if(jQuery.browser.mozilla&&e.type==="keypress"){pageDown()}}e.preventDefault()});$doc.bind("keydown keypress keyup",{combi:"pageup",disableInInput:true},function(e){if(!jQuery.browser.mozilla&&e.type==="keydown"){pageUp()}else{if(jQuery.browser.mozilla&&e.type==="keypress"){pageUp()}}e.preventDefault()});$doc.bind("keydown keypress keyup",{combi:"space",disableInInput:true},function(e){if(!jQuery.browser.mozilla&&e.type==="keydown"){pageDown()}else{if(jQuery.browser.mozilla&&e.type==="keypress"){pageDown()}}e.preventDefault()});$doc.bind("keydown keypress keyup",{combi:"shift+space",disableInInput:true},function(e){if(!jQuery.browser.mozilla&&e.type==="keydown"){pageUp()}else{if(jQuery.browser.mozilla&&e.type==="keypress"){pageUp()}}e.preventDefault()})})}function containDropdownsInWindow(){$doc.bind("showLayer",function(e,type,obj){var stalkerOffset,targetHeight;if(!isInitialized){initialize()}if(type==="dropdown"&&obj.$.parents(selector).length!==-1){stalkerOffset=($stalker.hasClass("detached")?0:$stalker.offset().top);targetHeight=jQuery(window).height()-$stalker.height()-stalkerOffset;if(targetHeight<=parseInt(obj.$.attr("scrollHeight"),10)){AJS.containDropdown.containHeight(obj,targetHeight)}else{AJS.containDropdown.releaseContainment(obj)}obj.reset();if(needToApplyFlickerFix()){$stalker.height($stalker.attr("scrollHeight"))}}}).bind("hideLayer",function(){if(needToApplyFlickerFix()){$stalker.height("")}})}if(!isSupported()){return}$win=jQuery(window);$doc=jQuery(document);selector=this.selector;offsetPageScrolling();containDropdownsInWindow();$doc.click(function(e){if(jQuery(e.target).parents(selector).length!==0&&!isInitialized){initialize()}});$doc.bind("showLayer",function(e,type){if($transitionElems){$transitionElems.css("opacity","")}if(jQuery.browser.mozilla&&type==="popup"){setStalkerPosition()}});jQuery(".stalker-placeholder, "+this.selector).offsetAnchors();function setStalkerPosition(){function getOpacitySetting(){var opacityTarget=1-$win.scrollTop()/offsetY;if(opacityTarget>1){return""}else{if(opacityTarget<0){return 0}else{return opacityTarget}}}if(!isInitialized){initialize()}$transitionElems.css("opacity",getOpacitySetting());if(offsetY<=$win.scrollTop()){if(!$stalker.hasClass("detached")){$stalker.css({top:0,position:"fixed"}).addClass("detached")}}else{$stalker.css(getInactiveProperties()).removeClass("detached")}lastScrollPosY=$win.scrollTop()}$win.scroll(setStalkerPosition).resize(function(){if($stalker){$stalker.trigger("stalkerHeightUpdated")}});$doc.mouseup(function(){if(lastScrollPosY&&$win.scrollTop()===lastScrollPosY){$transitionElems.css("opacity","   ")}});return this};