(function($){$.fn.upload=function(options){options=$.extend({name:"file",enctype:"multipart/form-data",action:"",autoSubmit:true,onSubmit:function(){},onComplete:function(){},onSelect:function(){},params:{}},options);return new $.ocupload(this,options)},$.ocupload=function(element,options){var self=this;var id=new Date().getTime().toString().substr(8);var iframe=$("<iframe "+'id="iframe'+id+'" '+'name="iframe'+id+'"'+"></iframe>").css({display:"none"});var form=$("<form "+'method="post" '+'enctype="'+options.enctype+'" '+'action="'+options.action+'" '+'target="iframe'+id+'"'+"></form>").css({margin:0,padding:0});form=form.insertBefore(element);element.appendTo(form);iframe.appendTo(form);element.change(function(){self.onSelect();if(self.autoSubmit){self.submit();form[0].reset()}});$.extend(this,{autoSubmit:true,onSubmit:options.onSubmit,onComplete:options.onComplete,onSelect:options.onSelect,filename:function(){return element.attr("value")},params:function(params){var params=params?params:false;if(params){options.params=$.extend(options.params,params)}else{return options.params}},name:function(name){var name=name?name:false;if(name){element.attr("name",value)}else{return element.attr("name")}},action:function(action){var action=action?action:false;if(action){form.attr("action",action)}else{return form.attr("action")}},enctype:function(enctype){var enctype=enctype?enctype:false;if(enctype){form.attr("enctype",enctype)}else{return form.attr("enctype")}},set:function(obj,value){var value=value?value:false;function option(action,value){switch(action){default:throw new Error("[jQuery.ocupload.set] '"+action+"' is an invalid option.");break;case"name":self.name(value);break;case"action":self.action(value);break;case"enctype":self.enctype(value);break;case"params":self.params(value);break;case"autoSubmit":self.autoSubmit=value;break;case"onSubmit":self.onSubmit=value;break;case"onComplete":self.onComplete=value;break;case"onSelect":self.onSelect=value;break}}if(value){option(obj,value)}else{$.each(obj,function(key,value){option(key,value)})}},submit:function(){this.onSubmit();$.each(options.params,function(key,value){form.append($("<input "+'type="hidden" '+'name="'+key+'" '+'value="'+value+'" '+"/>"))});form.submit();iframe.unbind().load(function(){var myFrame=document.getElementById(iframe.attr("name"));var response=$(myFrame.contentWindow.document.body).html();self.onComplete(response)})}})}})(jQuery);