jQuery(document).bind("iframeAppended",function(e,iframe){jQuery(iframe).load(function(){var target=jQuery(iframe).contents();target.bind("keyup keydown keypress",function(e){if(jQuery.browser.safari&&e.type==="keypress"){return}if(!jQuery(e.target).is(":input")){jQuery(document).trigger(e)}})})});AJS.whenIType=function(keys){var executer,bindKeys=function(keys){if(/\?/.test(keys)){jQuery(document).bind("keypress",{combi:keys,disableInInput:true},function(){if(!AJS.popup.current&&executer){executer()}})}else{if(keys=="/"){jQuery(document).bind("keypress keydown",{combi:keys,disableInInput:true},function(e){e.preventDefault()})}jQuery(document).bind("keyup",{combi:keys,disableInInput:true},function(){if(!AJS.popup.current&&executer){executer()}})}},addShortcutTitle=function(selector){var elem=jQuery(selector),title=elem.attr("title")||"",keyArr=keys.split("");if(elem.data("kbShortcutAppended")){appendShortcutTitle(elem,keyArr,title);return}title+=" ( "+AJS.params.keyType+" '"+keyArr.shift()+"'";jQuery.each(keyArr,function(){title+=" "+AJS.params.keyThen+" '"+this+"'"});title+=" )";elem.attr("title",title);elem.data("kbShortcutAppended",true)},appendShortcutTitle=function(elem,keyArr,title){title=title.replace(/\)$/," OR ");title+="'"+keyArr.shift()+"'";jQuery.each(keyArr,function(){title+=" "+AJS.params.keyThen+" '"+this+"'"});title+=" )";elem.attr("title",title)};bindKeys(keys);return{moveToNextItem:function(selector){executer=function(){var index,transition=true,items=jQuery(selector),focusedElem=jQuery(selector+".focused");if(!executer.blurHandler){jQuery(document).one("keypress",function(e){if(e.keyCode===27&&focusedElem){focusedElem.removeClass("focused")}})}if(focusedElem.length===0){transition=false;focusedElem=jQuery(selector).eq(0)}else{focusedElem.removeClass("focused");index=jQuery.inArray(focusedElem.get(0),items);if(index<items.length-1){index=index+1;focusedElem=items.eq(index)}else{focusedElem.removeClass("focused");focusedElem=jQuery(selector).eq(0);transition=false}}if(focusedElem&&focusedElem.length>0){focusedElem.addClass("focused");focusedElem.moveTo(transition);focusedElem.find("a:first").focus()}}},moveToPrevItem:function(selector){executer=function(){var index,transition=true,items=jQuery(selector),focusedElem=jQuery(selector+".focused");if(!executer.blurHandler){jQuery(document).one("keypress",function(e){if(e.keyCode===27&&focusedElem){focusedElem.removeClass("focused")}})}if(focusedElem.length===0){transition=false;focusedElem=jQuery(selector+":last")}else{focusedElem.removeClass("focused");index=jQuery.inArray(focusedElem.get(0),items);if(index>0){index=index-1;focusedElem=items.eq(index)}else{focusedElem.removeClass("focused");focusedElem=jQuery(selector+":last");transition=false}}if(focusedElem&&focusedElem.length>0){focusedElem.addClass("focused");focusedElem.moveTo(transition);focusedElem.find("a:first").focus()}}},click:function(selector){addShortcutTitle(selector);executer=function(){var elem=jQuery(selector);if(elem.length>0){elem.click()}}},goTo:function(location){executer=function(){window.location.href=contextPath+location}},followLink:function(selector){addShortcutTitle(selector);executer=function(){var elem=jQuery(selector);if(elem.length>0&&elem.attr("nodeName").toLowerCase()==="a"){window.location.href=elem.attr("href")}}},execute:function(func){executer=function(){func()}},moveToAndClick:function(selector){addShortcutTitle(selector);executer=function(){var elem=jQuery(selector);if(elem.length>0){elem.click();elem.moveTo()}}},moveToAndFocus:function(selector){addShortcutTitle(selector);executer=function(){var elem=jQuery(selector);if(elem.length>0){elem.focus();elem.moveTo()}}},or:function(keys){bindKeys(keys);return this}}};